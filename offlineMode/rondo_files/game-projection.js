/**
 * Represents a search trough an array.
 * @function search
 * @param {Array} array - The array you wanna search trough
 * @param {string} key - The key to search for
 * @param {string} [prop] - The property name to find it in
 */


var json = {"version":"1.0","encoding":"UTF-8","feed":{"xmlns":"http://www.w3.org/2005/Atom","xmlns$openSearch":"http://a9.com/-/spec/opensearchrss/1.0/","xmlns$gsx":"http://schemas.google.com/spreadsheets/2006/extended","id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Rondo - Environmental justice"},"link":[{"rel":"alternate","type":"application/atom+xml","href":"https://docs.google.com/a/benmoren.com/spreadsheets/d/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/pubhtml"},{"rel":"http://schemas.google.com/g/2005#feed","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full"},{"rel":"http://schemas.google.com/g/2005#post","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full"},{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full?alt\u003djson-in-script"}],"author":[{"name":{"$t":"ben"},"email":{"$t":"ben@benmoren.com"}}],"openSearch$totalResults":{"$t":"37"},"openSearch$startIndex":{"$t":"1"},"entry":[{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cokwr"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are native wildflower seeds. Start as a seed on the ground, sprout, and grow to transform a vacant lot into a vibrant ecosystem!"},"content":{"type":"text","$t":"lowplayers: 6, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cokwr"}],"gsx$prompt":{"$t":"You are native wildflower seeds. Start as a seed on the ground, sprout, and grow to transform a vacant lot into a vibrant ecosystem!"},"gsx$lowplayers":{"$t":"6"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cpzh4"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be a tree or a mudslide. Trees: stand tall and root down to stabilize soil. Stand strong against a mudslide, rolling and tumbling your way!"},"content":{"type":"text","$t":"lowplayers: 8, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cpzh4"}],"gsx$prompt":{"$t":"Choose to be a tree or a mudslide. Trees: stand tall and root down to stabilize soil. Stand strong against a mudslide, rolling and tumbling your way!"},"gsx$lowplayers":{"$t":"8"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cre1l"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Crawl and ooze together to form a big pile of stinky food waste in a landfill. Off-gas methane into the atmosphere.  "},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cre1l"}],"gsx$prompt":{"$t":"Crawl and ooze together to form a big pile of stinky food waste in a landfill. Off-gas methane into the atmosphere.  "},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/chk2m"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Together, use your bodies to form a healthy compost pile, complete with worms, spiders, snails, and bacteria all feasting on scraps!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/chk2m"}],"gsx$prompt":{"$t":"Together, use your bodies to form a healthy compost pile, complete with worms, spiders, snails, and bacteria all feasting on scraps!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ciyn3"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: Together, you are a wildfire raging in a drought-weakened forest. Leap, roar, and crackle until you've filled the entire space with flames."},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ciyn3"}],"gsx$prompt":{"$t":"Everyone: Together, you are a wildfire raging in a drought-weakened forest. Leap, roar, and crackle until you've filled the entire space with flames."},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ckd7g"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Be bears, deer, and birds lumbering, leaping, and flying from a drought-caused wildfire. Roar/squack to alert others!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ckd7g"}],"gsx$prompt":{"$t":"Be bears, deer, and birds lumbering, leaping, and flying from a drought-caused wildfire. Roar/squack to alert others!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/clrrx"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Snow melts early in spring, and you are snowshoe hares who still have their white winter coats. A fox spots you... Escape!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/clrrx"}],"gsx$prompt":{"$t":"Snow melts early in spring, and you are snowshoe hares who still have their white winter coats. A fox spots you... Escape!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cyevm"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A warm winter means less insulating snow above a your pika den. A cold snap hits. Everyone: Make high-pitched squeaks to express your dismay!"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cyevm"}],"gsx$prompt":{"$t":"A warm winter means less insulating snow above a your pika den. A cold snap hits. Everyone: Make high-pitched squeaks to express your dismay!"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cztg3"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Cluster together; you are snow melting in an early spring thaw. Shrink slowly, and spread out as you become flowing water."},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cztg3"}],"gsx$prompt":{"$t":"Cluster together; you are snow melting in an early spring thaw. Shrink slowly, and spread out as you become flowing water."},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d180g"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are trees on a river bank in Alaska, where a warming climate has melted the permafrost that surrounds your roots. Lean over, farther and farther, as your roots lose their hold."},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d180g"}],"gsx$prompt":{"$t":"You are trees on a river bank in Alaska, where a warming climate has melted the permafrost that surrounds your roots. Lean over, farther and farther, as your roots lose their hold."},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d2mkx"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: A forest has been clear-cut. Kneel down on the ground; you are the stumps of the recently logged trees. "},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d2mkx"}],"gsx$prompt":{"$t":"Everyone: A forest has been clear-cut. Kneel down on the ground; you are the stumps of the recently logged trees. "},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cssly"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"4 people are photons in a solar panel, 8 others are atom/electron pairs. Photons, knock those electrons off the atoms to make electricity!"},"content":{"type":"text","$t":"lowplayers: 12, highplayers: 12, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cssly"}],"gsx$prompt":{"$t":"4 people are photons in a solar panel, 8 others are atom/electron pairs. Photons, knock those electrons off the atoms to make electricity!"},"gsx$lowplayers":{"$t":"12"},"gsx$highplayers":{"$t":"12"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cu76f"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be a hiker or a carbon dioxide-loving poison ivy plant. Poison ivy, cluster your leaves in groups of three and get ready to itch those hapless hikers!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 7, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cu76f"}],"gsx$prompt":{"$t":"Choose to be a hiker or a carbon dioxide-loving poison ivy plant. Poison ivy, cluster your leaves in groups of three and get ready to itch those hapless hikers!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"7"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cvlqs"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Drought has shrunk the overwintering forest of a group of monarch butterfies. Fan your beautiful wings as you cluster together! Can you all fit on one branch?"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cvlqs"}],"gsx$prompt":{"$t":"Drought has shrunk the overwintering forest of a group of monarch butterfies. Fan your beautiful wings as you cluster together! Can you all fit on one branch?"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cx0b9"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be rain or a rainbarrel. Rain barrel: join hands and arms to form a barrel. How much rain can you catch?"},"content":{"type":"text","$t":"lowplayers: 6, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/cx0b9"}],"gsx$prompt":{"$t":"Choose to be rain or a rainbarrel. Rain barrel: join hands and arms to form a barrel. How much rain can you catch?"},"gsx$lowplayers":{"$t":"6"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d9ney"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are a group of Guinea Fowl who love eating ticks! Hop around, squawk, and honk loudly as you hunt for tasty ticks! Yum!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d9ney"}],"gsx$prompt":{"$t":"You are a group of Guinea Fowl who love eating ticks! Hop around, squawk, and honk loudly as you hunt for tasty ticks! Yum!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/db1zf"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A warm year means lots and lots of midges. Form a cloud together and hum!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/db1zf"}],"gsx$prompt":{"$t":"A warm year means lots and lots of midges. Form a cloud together and hum!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dcgjs"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A cloud of midges descends on a herd of deer. Run, deer! Hum, midges!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dcgjs"}],"gsx$prompt":{"$t":"A cloud of midges descends on a herd of deer. Run, deer! Hum, midges!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ddv49"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Increased rainfall and flooding make it easier for harmful mold to grow. Grow as mold by laying on the ground or starting from a crouch. Slowly expand, spreading arms, legs, hands, and fingers!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/ddv49"}],"gsx$prompt":{"$t":"Increased rainfall and flooding make it easier for harmful mold to grow. Grow as mold by laying on the ground or starting from a crouch. Slowly expand, spreading arms, legs, hands, and fingers!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d415a"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Warming temperatures have resulted in a longer pollen production season. Become pollen particles and find noses to itch! "},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d415a"}],"gsx$prompt":{"$t":"Warming temperatures have resulted in a longer pollen production season. Become pollen particles and find noses to itch! "},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d5fpr"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Warming temperatures bring parasites that change tadpole development. When the tadpoles turn into frogs, they only have one hind leg! Croak and ribbet as you try to hop on your only leg."},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d5fpr"}],"gsx$prompt":{"$t":"Warming temperatures bring parasites that change tadpole development. When the tadpoles turn into frogs, they only have one hind leg! Croak and ribbet as you try to hop on your only leg."},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d6ua4"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Be tree moss: sit on the ground and wave your arms and legs to collect chemical compounds from the air, helping pinpoint pollution levels!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d6ua4"}],"gsx$prompt":{"$t":"Be tree moss: sit on the ground and wave your arms and legs to collect chemical compounds from the air, helping pinpoint pollution levels!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d88ul"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One or two people are wind turbines in the ocean. The rest of you, become a hurricane by joining hands and spinning around. Turbines, capture as much wind energy from the hurricane as you can!"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/d88ul"}],"gsx$prompt":{"$t":"One or two people are wind turbines in the ocean. The rest of you, become a hurricane by joining hands and spinning around. Turbines, capture as much wind energy from the hurricane as you can!"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dkvya"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Mosquitoes grow in number as temperatures warm. Buzz, buzz! Dragonflies, zoom around, catching and eating as many as you can!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dkvya"}],"gsx$prompt":{"$t":"Mosquitoes grow in number as temperatures warm. Buzz, buzz! Dragonflies, zoom around, catching and eating as many as you can!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dmair"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are a freshly washed item of clothing clipped on a clothesline, sway in the wind and get dried out!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dmair"}],"gsx$prompt":{"$t":"You are a freshly washed item of clothing clipped on a clothesline, sway in the wind and get dried out!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dnp34"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be a bee or a carbon dioxide molecule. Bees buzz around, looking for flowers, but you can't smell as well when carbon dioxide levels are up! Carbon dioxide, block the bees to confuse them!"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dnp34"}],"gsx$prompt":{"$t":"Choose to be a bee or a carbon dioxide molecule. Bees buzz around, looking for flowers, but you can't smell as well when carbon dioxide levels are up! Carbon dioxide, block the bees to confuse them!"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dp3nl"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A group of cicadas emerge early from the ground and take flight into the trees. Buzz and sing loudly to find mates!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dp3nl"}],"gsx$prompt":{"$t":"A group of cicadas emerge early from the ground and take flight into the trees. Buzz and sing loudly to find mates!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/df9om"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Drying habitat has killed grass that a group of crickets normally eats. But they have another option – eating each other! Gnaw and chirp. Who will win?"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/df9om"}],"gsx$prompt":{"$t":"Drying habitat has killed grass that a group of crickets normally eats. But they have another option – eating each other! Gnaw and chirp. Who will win?"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dgo93"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Link up to form an electric train. How fast can you go? What sounds does your train make?"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dgo93"}],"gsx$prompt":{"$t":"Link up to form an electric train. How fast can you go? What sounds does your train make?"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/di2tg"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are lightbulbs in a house. Turn on, turn off. "},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 5, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/di2tg"}],"gsx$prompt":{"$t":"You are lightbulbs in a house. Turn on, turn off. "},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"5"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/djhdx"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One person each is a TV, a speaker, a computer, and a coffee maker - energy vampires! Suck up as much energy as you can. Others try to turn off or unplug the energy vampires!"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/djhdx"}],"gsx$prompt":{"$t":"One person each is a TV, a speaker, a computer, and a coffee maker - energy vampires! Suck up as much energy as you can. Others try to turn off or unplug the energy vampires!"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dw4je"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One person is the sun beating down on a hot day. Using your bodies, form a shelter from the sun keep someone from getting heatstroke!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 5, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dw4je"}],"gsx$prompt":{"$t":"One person is the sun beating down on a hot day. Using your bodies, form a shelter from the sun keep someone from getting heatstroke!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"5"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dxj3v"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"It's a climate emergency! Choose to be either a geoengineer or a sulfate particle. Geoengineers: shoot sulfate particles into the upper atmosphere, cooling the planet by mimicking a large volcanic eruption."},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dxj3v"}],"gsx$prompt":{"$t":"It's a climate emergency! Choose to be either a geoengineer or a sulfate particle. Geoengineers: shoot sulfate particles into the upper atmosphere, cooling the planet by mimicking a large volcanic eruption."},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dyxo8"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are steam rising from a young volcano. A geothermal operation just captured you to convert you to energy, jump up and down as high as you can to release your energy!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dyxo8"}],"gsx$prompt":{"$t":"You are steam rising from a young volcano. A geothermal operation just captured you to convert you to energy, jump up and down as high as you can to release your energy!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/e0c8p"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Be a bicycle and go for a ride!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/e0c8p"}],"gsx$prompt":{"$t":"Be a bicycle and go for a ride!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dqi9q"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are a family of beavers. Together, can you build a dam against an early snowmelt? Chatter and slap your tails as you work!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 9, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/dqi9q"}],"gsx$prompt":{"$t":"You are a family of beavers. Together, can you build a dam against an early snowmelt? Chatter and slap your tails as you work!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"9"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/drwu7"},"updated":{"$t":"2017-06-10T07:22:43.790Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Join hands and become a fire. Together, race along a prairie, burning the ground and rejuvinating the soil! "},"content":{"type":"text","$t":"lowplayers: 3, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/4/public/full/drwu7"}],"gsx$prompt":{"$t":"Join hands and become a fire. Together, race along a prairie, burning the ground and rejuvinating the soil! "},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}}]}}

var searchResults;




function search(array, key, prop){
    // Optional, but fallback to key['name'] if not selected
    prop = (typeof prop === 'undefined') ? 'name' : prop;
    var tempArray = [];
    for (var i=0; i < array.length; i++) {
        // console.log(array[i][prop]);
        //if (array[i][prop] <= Maxkey && array[i][prop] >= minkey) {
        if (array[i][prop] <= key) {
            tempArray.push(array[i]);
        } else if(array[i][prop] == 'all'){
            tempArray.push(array[i]);
        }
    }
    return tempArray;
}

var allTasks = []


function moreDetails(click){
     var $this = null;
     // check if object is jquery object
     if(click instanceof jQuery){
          $this = click;
     } else {
          // this is a javascript object
          $this = $('#'+click.id);
     }
     var href = $this.attr("href");
     var hash = href.substr(1);

     if($this.hasClass('artwork')){
          showArtworkClose();

          console.log('artwork');

          // Get project desc panel and send it to marker as visited function
          var $thisProject = $this.parents('.project-slide-panel');
          //setMarkerAsVisited($thisProject);


          //console.log($this.attr('data-project-url'));
          var projectUrl = $this.attr('data-project-url');
          var $iframe = $('.iframe.project-slide-panel');
          //customProblemsAndFixesArtwork($('.slideUp.project-slide-panel'));

          //Set Panel from display none to display block
          $iframe.css('display','block');

          //Set Panel src
          $iframe.attr('src',projectUrl);

          //If we don't set a slight timeout the css animation won't work.
          setTimeout(function(){
            $iframe.addClass('slideUp');
          },100);

        }  else {

                    //Set Panel from display none to display block
                    $('.page.'+hash).css('display','block');

                    //If we don't set a slight timeout the css animation won't work.
                    setTimeout(function(){
                         $('.page.'+hash).addClass('slideUp');
                    },100);

                    var currentPageImage = $('.project-slide-panel.'+hash).find('.location-image-large');
                    var currentPage = $('.project-slide-panel.'+hash);
                    var currentImage = currentPage.attr('data-image')
                   if(currentPageImage.length){
                     $('<img/>').attr('src', '/assets/images/locations/'+currentImage+'-large.jpg').load(function() {
                      $(this).remove(); // prevent memory leaks as @benweet suggested
                      currentPageImage.css('background-image', 'url(/assets/images/locations/'+currentImage+'-large.jpg)');
                      currentPageImage.delay(700).velocity({opacity: 1},600);
                     });
                   }

           }
}

function slideDownPanel(link){
     var $this = link;

     if($this.hasClass('artwork')){
          var $iframe = $('.iframe.project-slide-panel');
          hideArtworkClose();

          $iframe.velocity({opacity: 0}, 150, function(){

            setTimeout(function(){
              $iframe.css('display','none');
              $iframe.attr('src', $iframe.attr('data-fake-src'));
              $iframe.removeClass('slideUp');

              setTimeout(function(){
                $iframe.removeClass('white'); // This is a fix for some of the projects
                $('.close.artwork').removeClass('black'); // This is a fix for some of the projects
                $iframe.css('opacity','1');
              },1);

            }, 1);



          });


        } else {
     if($this.parent('.nav').parent('.page').hasClass('sign-up')){
          $('#carousel-sign-up').carousel(0);
     }
     $this.parent('.nav').parent('.page').removeClass('slideUp');
     setTimeout(function(){
       $this.parent('.nav').parent('.page').css('display','none');
     }, 750);

     }
}

/**********************
Globals
**********************/
if(SETTINGS.server == 'localhost'){
    socket = io('http://localhost:3000');
} else if(SETTINGS.server == 'server-http'){
    //console.log = function() {}
    socket = io('http://joincollectiveaction.com:3000');
} else if(SETTINGS.server == 'server-https'){
   //console.log = function() {}
   socket = io('https://joincollectiveaction.com:3000', { secure : true});
}

//var socket = io('http://localhost:3000'); //MAKE SSURE TO CHANGE THIS TO THE SERVER'S IP LATER!
//var socket = io('https://joincollectiveaction.com:3000', { secure : true}); //MAKE SSURE TO CHANGE THIS TO THE SERVER'S IP LATER!


//reload the view when the app boots up & this page connects


// var time;

// const GAME_LOCATION = 'location1' ///////////IMPORTANT ***** SET GAME LOCATION IN game-projection.hbs

/**********************
Helper Functions
**********************/
function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min)) + min;
}



var gameProjection = {
     bodyElement: $('body'),
     currentNumberOfConnections:100,
     requestedNumberOfConnections: false,
     currentPlayers:null,
     requestedCurrentPlayers: 100,
     currentTask:null,

     requestedTask: false,
     prepFrameCounter:0,
     taskFrameCounter:0,
     numberOfTimesGetDataHasRun: 0,
     wait:15000,
     state:'title',
     gameStateIndex:0,

     // Time Variables
     TimeTitle: 15000,
     TimeHighscoresPlayers:10000,
     TimeHighscoresTeams:10000,
     TimeGetNumberOfConnectionsTaskPlayers:500,
     TimeSetupGame:500,
     TimeInviteToPerformanceArea: 5000,
     TimeWeNeedMorePlayers: 5000,
     TimePrepForTask: 15000,
     TimeStartTask: 30000,
     TimeEndTask: 8000,
     TimeEndScore: 7000,
     TimeReset: 250,
     avatarLimit:100,
     taskPlayedCounter: 1,
     //gameStates:['highscore players','highscore team','teaser','get players','get task','start task'],
     init: function(){
          //gameProjection.addLocationClassToBody();

           $('#movie-intro').get(0).play()

          time = new Date().getTime();//store the current time
          // this.getNewTask();
          // this.newGame()

          // socket.on('connect', function(){
          //     console.log('connected to the server as: ' + socket.id);
          //
          //     socket.emit('joinProjectinoRoom', GAME_LOCATION) //join my own room!
          //
          //     //reset state on page refresh / re-connect of game-projection
          //     socket.emit('resetRoomClients', GAME_LOCATION);
          //
          //     setTimeout(function(){ // This is here for a weird problem for when the projections crashes and you need to reload the page this is here to make sure it gets the already connected users.
          //       socket.emit('getAllUsers',GAME_LOCATION, function(users){
          //           users.forEach(function(user){
          //             if(avatars.length >= gameProjection.avatarLimit){
          //               return;
          //             } else {
          //               var a = new avatar('assets/images/avatarsHalfSize/'+user.userObject.avatar+'', user.id, random(0,width),random(0,height))
          //               avatars.push(a)
          //             }
          //           })
          //
          //       })
          //     },1500);
          // });

          //gameProjection.parseTitleUrlParamater();
          //socket.on('disconnect', function(){
          //     console.log('disconnected from the server as: ' + socket.id);
          //});

         //socket.on('addAvatar',function(user){
         //  console.log('addAvatar',user);
         //  if(avatars.length >= gameProjection.avatarLimit){
         //    return;
         //  } else {
         //    var a = new avatar('assets/images/avatarsHalfSize/'+user.userObject.avatar+'', user.id, random(0,width),random(0,height))
         //    avatars.push(a)
         //  }
         //})
         //socket.on('removeAvatar',function(user){
         //  console.log('removeAvatar',user);

         //  for (var i = 0; i < avatars.length; i++) {

         //     if(avatars[i].id == user.id){
         //       avatars[i].state = 'avatarIsShrinking';
         //       avatars[i].startTime = performance.now();
         //       avatars[i].endTime = avatars[i].startTime + duration2;
         //       soundReverse.playbackRate = random(.8,1.5);
         //       soundReverse.play();
         //     }
         //  }

         //})

     },
     addLocationClassToBody:function(){
      $('body').addClass(GAME_LOCATION);
     },
     parseTitleUrlParamater:function(){
      var title = $('.location-title').text();
      var titleElement = $('.location-title')
      var titleIcon = $('.location-icon')
      var urlForIcons = 'assets/images/projections/location-icons/'
      switch (title) {
        case 'commons':
            titleIcon.attr('src',urlForIcons+'icon_commons.png');
            titleElement.html('Commons');
            break;
        case 'westbank':
            titleIcon.attr('src',urlForIcons+'icon_cedarriverside.png');
            titleElement.html('Westbank');
            break;
        case 'littleafrica':
            titleIcon.attr('src',urlForIcons+'icon_littleafrica.png');
            titleElement.html('Little Africa');
            break;
        case 'rondo':
            titleIcon.attr('src',urlForIcons+'icon_rondo.png');
            titleElement.html('Rondo');
            break;
        case 'littlemekong':
            titleIcon.attr('src',urlForIcons+'icon_littlemekong.png');
            titleElement.html('Little Mekong');
            break;
        case 'lowertown':
            titleIcon.attr('src',urlForIcons+'icon_lowertown.png');
            titleElement.html('Lowertown');
            break;
      }
     },
     changeState:function(string){
      gameProjection.state = string;
     },
     setStateAndTime:function(state, waitTime){
      var self = this;
      console.log(state);
      if(state != 'get-number-of-connections-task-players' && state != 'get-number-of-connections' && state != 'get-task' && state != 'get-players'){
        slideDownPanel($('.page.slideUp .close'));
        moreDetails($('.page.'+state+' .nav a'));
      }
      if($('body').hasClass('warning')){
        $('body').removeClass('warning');
      }
      self.state = state;
      self.wait = waitTime
     },
     removeBodyClassForAnimatedBackground:function(){
      var self = this;
      if(self.bodyElement.hasClass('warning')){
        self.bodyElement.removeClass('warning');
      }
     },
     animateBackgroundForLowTime:function(){
      var self = this;
      var prepTime = Math.floor(self.TimePrepForTask/1000 - (self.prepFrameCounter/60));
      var taskTime = Math.floor(self.TimeStartTask/1000 - (self.taskFrameCounter/60));

      if(taskTime < 10 && self.state == 'start-task'){
        self.bodyElement.addClass('warning');
      } else if(prepTime < 10 && self.state == 'prep-for-task'){
        self.bodyElement.addClass('warning');
      }
     },
     reset:function(){
      var self = this;
      //self.currentNumberOfConnections = null;
      //self.requestedNumberOfConnections = false;
      //self.currentPlayers = null;
      //self.requestedCurrentPlayers = false;
      //self.currentTask = null;
      //self.requestedTask = false;

      self.prepFrameCounter = 0;
      self.taskFrameCounter = 0;
      console.log('reset');
      //self.numberOfTimesGetDataHasRun = 0;
      self.taskPlayedCounter;
     },
     writeInvitionToScreen:function(){
        var textBox = $('.invite-to-performance-area .container .inner-container p');
        var self = this;
        var text = 'Players: Come on up!'
        if(self.currentTask.playersMax == 'all'){
          text = 'Everyone: Get Ready!'
        }
        textBox.html(text);
     },
      checkTimer:function(){
           var self = this;
           if(new Date().getTime() - time >= self.wait) {
                console.log("tick2");//if it is, do something
                time = new Date().getTime();//also update the stored time
                switch (self.state) {
                  case 'title':
                      self.hideIntroVideo();
                      self.getTask();
                      self.setStateAndTime('setup-game', self.TimeSetupGame); // OFFLINE MODE
                      //self.setStateAndTime('highscores-players', self.TimeHighscoresPlayers);
                      self.writeHighScoresToScreen();

                      // self.refreshConnectedBackgroundAvatars();
                      break;
                  case 'highscores-players':

                      //self.setStateAndTime('highscores-teams', self.TimeHighscoresTeams);
                      self.writeTeamScoresToScreen()
                      break;
                  case 'highscores-teams':
                      self.setStateAndTime('get-number-of-connections-task-players', self.TimeGetNumberOfConnectionsTaskPlayers);
                      break;
                  case 'get-number-of-connections-task-players':
                      self.checkIfNumberOfConnectionsIsEmptyAndGet();
                      self.checkIfTaskIsEmptyAndGet();
                      self.checkIfPlayersIsEmptyAndGet();
                      if(self.currentNumberOfConnections != null && self.currentTask != null && self.currentPlayers != null && allTasks.length > 0){
                        self.setStateAndTime('setup-game', self.TimeSetupGame);
                      } else if(self.currentNumberOfConnections <= 1 && self.currentTask != null && self.currentPlayers <= 1 && allTasks.length > 0){
                        console.log('333!!!!!!!!!!!!!!!!!!!!!')
                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                      } else if(self.numberOfTimesGetDataHasRun > 15) {
                        //console.log('444!!!!!!!!!!!!!!!!!!!!!')

                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                        self.reset();
                        self.numberOfTimesGetDataHasRun = 0; // Maybe this should be self.reset();
                      } else {
                        self.setStateAndTime('get-number-of-connections-task-players', 100);
                        self.numberOfTimesGetDataHasRun++;
                      }
                      break;
                  case 'setup-game':
                      // self.newGame();
                      self.writeTaskToScreen();
                      self.writeInvitionToScreen();
                      $('#sound-call-people')[0].play();
                      self.setStateAndTime('invite-to-performance-area', self.TimeInviteToPerformanceArea);
                      break;
                  case 'invite-to-performance-area':
                      //check to change the screen to wait for more players if there are less than 2.
                      if(self.currentNumberOfConnections < 2) {
                        self.setStateAndTime('we-need-more-players', self.TimeWeNeedMorePlayers);
                      } else {
                        self.setStateAndTime('prep-for-task', self.TimePrepForTask);
                        $('#sound-get-ready')[0].play();
                      }
                      //var interval = 0;
                      //self.setStateAndTime('get-players', self.wait);
                      //$('.page .people ul li').each(function(){
                      //  interval = interval + 2000;
                      //  $(this).delay(interval).animate({opacity:1});
                      //});
                      break;
                  case 'we-need-more-players':
                      self.setStateAndTime('get-number-of-connections-task-players', self.TimeGetNumberOfConnectionsTaskPlayers);
                      break;
                  case 'prep-for-task':
                      // time to get ready
                      console.log(gameProjection.currentPlayers)
                      self.setStateAndTime('start-task',  self.TimeStartTask);
                      self.removeBodyClassForAnimatedBackground();
                      $('#sound-start')[0].play();
                      //self.setStateAndTime('start-task',  gameProjection.currentTask.time);
                      break;
                  case 'start-task':
                      self.setStateAndTime('end-task', self.TimeEndTask);
                      self.removeBodyClassForAnimatedBackground();
                      //$('#sound-cheers')[0].play();
                      $('#movie-great-job').get(0).play()
                      break;
                  case 'end-task':
                      //self.setStateAndTime('end-score', self.TimeEndScore);
                      self.setStateAndTime('reset', self.TimeReset);
                      break;
                  case 'end-score':
                      //self.setStateAndTime('reset', self.TimeReset);
                      break;
                  case 'reset':
                      //socket.emit('resetViews', self.currentPlayers)
                      self.reset();
                      if(gameProjection.taskPlayedCounter >= 5){
                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                        gameProjection.taskPlayedCounter = 1;
                      } else {
                      	self.getTask();
                        self.setStateAndTime('setup-game', self.TimeSetupGame);
                        gameProjection.taskPlayedCounter++
                      }


                      break;
                }
                //self.state = self.gameStates[self.gameStateIndex % 5];
                //self.gameStateIndex++;
                //gameProjection.getNewTask();
           }
      },
      hideIntroVideo:function(){
        $('#movie-intro').css('display','none');
      },
      playerIntroVideo:function(){
        $('#movie-intro').css('display','block');
        $('#movie-intro').get(0).play();
      },
      draw:function(){
          var self = gameProjection;
          requestAnimationFrame(self.draw);
          switch (self.state) {
            case 'title':
                console.log('title');
                console.log();
                //if($('#movie-intro').get(0).currentTime > 15){
                //
                //
                //}
                self.checkTimer();
                //slideDownPanel($('.page.sign-up .close'));
                break;
            case 'highscores-players':
                console.log('highscores-players');
                self.checkTimer();
                break;
            case 'highscores-teams':
                console.log('highscore team');
                self.checkTimer();
                break;
            case 'get-number-of-connections-task-players':
                console.log('get-number-of-connections-task-players');
                self.checkTimer();
                break;
            case 'setup-game':
                console.log('get-players');
                self.checkTimer();
                break;
            case 'invite-to-performance-area':
                console.log('invite-to-performance-area');
                self.checkTimer();
                break;
            case 'we-need-more-players':
                console.log('we-need-more-players');
                self.checkTimer();
                break;
            case 'prep-for-task':
                console.log('prep for task');
                self.writePrepTimeToScreen();
                self.animateBackgroundForLowTime();
                self.checkTimer();
                break;
            case 'start-task':
                // time to get ready
                console.log('start task');
                self.writeTaskTimeToScreen();
                self.animateBackgroundForLowTime();
                self.checkTimer();
                break;
            case 'end-task':
                console.log('end task');
                self.checkTimer();
                break;
            case 'end-score':
                console.log('end score');
                self.checkTimer();
                break;
            case 'reset':
                console.log('reset task');
                self.checkTimer();
                break;
          }


     },

    checkIfNumberOfConnectionsIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedNumberOfConnections == false){
        self.requestedNumberOfConnections = true;
        self.checkNumberOfConnections();
      }
    },
    checkNumberOfConnections:function(){
        gameProjection.currentNumberOfConnections = Math.ceil(Math.random()*10); // OFFLINE MODE
    },
    checkIfPlayersIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedCurrentPlayers == false && self.currentTask != null){
        self.requestedCurrentPlayers = true;
        self.getPlayers();
      }
    },
    getPlayers:function(){
      //gameProjection.currentTask.location = GAME_LOCATION;
      //socket.emit('getNewAndNotifyUsers', gameProjection.currentTask, function(chosenPlayers){
      //  console.log(chosenPlayers);
      //  gameProjection.currentPlayers = chosenPlayers;
      //}); // close getNewAndNotifyUsers
    },
    checkIfTaskIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedTask == false && self.currentNumberOfConnections != null){
        self.requestedTask = true;
        self.getTask();
      }
    },
    getTask:function(){
      var numberOfPlayers = gameProjection.currentNumberOfConnections;
      searchResults = null;
      if(gameProjection.currentNumberOfConnections < 2){
        console.log('less then 2 ')
        // This need to be changed not to grab specific number of connections but only task that have a minimum number of connections
        searchResults = [];
      } else {
        console.log('more then 2 ')

        searchResults = search(allTasks, gameProjection.currentNumberOfConnections,'playersMin')
        //searchResults = allTasks[getRandomInt(0,allTasks.length)];
      }
      // console.log(ameProjection.currentTask.time);
      gameProjection.currentTask = searchResults[getRandomInt(0,searchResults.length)];
      console.log(gameProjection.currentTask.time);
      gameProjection.TimeStartTask = parseInt(gameProjection.currentTask.time);
      console.log(gameProjection.TimeStartTask);
    },
    writeTaskToScreen:function(){
      var task = gameProjection.currentTask.task;
      $('.currentTask').html(task);
    },
    writePrepTimeToScreen:function(){
      var self = this;
      self.prepFrameCounter++;
      var prepTime = Math.floor(self.TimePrepForTask/1000 - (self.prepFrameCounter/60));
      $('.prep-time').html(prepTime);
    },
    writeTaskTimeToScreen:function(){
      var self = this;
      self.taskFrameCounter++;
      var taskTime = Math.floor(self.TimeStartTask/1000 - (self.taskFrameCounter/60));
      $('.task-time').html(taskTime);
    },
    setupDebugTimes:function(){
        var self = this;
        self.TimeTitle = 1000;
        self.TimeHighscoresPlayers = 1000;
        self.TimeHighscoresTeams = 1000;
        self.TimeGetNumberOfConnectionsTaskPlayers = 500;
        self.TimeSetupGame = 500;
        self.TimeInviteToPerformanceArea = 3000;
        self.TimeWeNeedMorePlayers = 3000;
        self.TimePrepForTask = 3000;
        self.TimeStartTask = 5000;
        self.TimeEndTask = 8000;
        self.TimeEndScore = 1000;
        self.TimeReset = 250;
    },
    setupDebugPrompts(){
      var numberOfPlayers = gameProjection.currentNumberOfConnections;
      searchResults = null;
      searchResults = search(allTasks, 999,'playersMin')
      var currentTaskIndex = 0;

      gameProjection.setStateAndTime('start-task',  99999999999999);
      // console.log(ameProjection.currentTask.time);
      setInterval(function(){
        gameProjection.currentTask = searchResults[currentTaskIndex];
        gameProjection.writeTaskToScreen();
        currentTaskIndex++;
      }, 1500);
    },
    writeHighScoresToScreen:function(){
      socket.emit('getHighScoreUsers',function(results){
        console.log('highScores',results);
        var appendData = ''
        results.forEach(function(result){
          appendData += '<div><div style="float:left;width:50px;height:50px;background-image:url(assets/images/avatarsHalfSize/'+ result.avatar +');background-repeat:no-repeat;background-position:center center;background-size:contain;" ></div><p class="align-left" >' + result.userName + '</p><p class="align-right">' + result.score + '</p><div style="clear:both"></div></div>';
        })
        // console.log(appendData);
        $('.scoreBoard').html(appendData)
      })
    },
    writeTeamScoresToScreen:function(){
      socket.emit('getTeamScores',function(results){
        // console.log(results);

        results.sort(function(a, b) {
            return b.score - a.score
        })
        // console.log('😬',results);

        var appendData = ''
        results.forEach(function(result){
          var teamString =''
          if(result.team == 1){
              teamString = '<div style="color:#4baaf8"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/1.png"> Water</p> '
          }else if(result.team == 2){
              teamString = '<div style="color:#8e98f8"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/2.png"> Air</p> '
          }else if(result.team == 3){
            teamString = '<div style="color:#97c355"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/3.png"> Earth</p> '
          }else if(result.team == 4){
            teamString = '<div style="color:#e88f3d"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/4.png"> Fire</p> '
          }

          appendData += teamString+'<p class="align-right">' + result.score + '</p><div style="clear:both"></div></div>'
        })

        $('.teamScoreBoard').html(appendData)

      })
    },
    // refreshConnectedBackgroundAvatars:function(){
    //   socket.emit('getAllUsers', GAME_LOCATION, function(connectedUsers) {
    //     console.log('gau',connectedUsers);
    //     compiledAvatars = ''
    //     connectedUsers.forEach(function(user){
    //       //compiledAvatars+= '<img src="assets/images/avatars/'+  +'">'
    //         var id = user.userObject.id;
    //         if(avatars.filter(function(e) { return e.id == id }).length > 0){
    //           // Do nothing
    //         } else {
    //           var a = new avatar('assets/images/avatars/'+user.userObject.avatar+'',user.userObject.id, random(0,width),random(0,height),  )
    //           avatars.push(a)
    //         }
    //     })
    //     //$('.tempAvatarStorage').html(compiledAvatars)
    //   }); // close getNewAndNotifyUsers
    // },
    convertSpreadsheetToTasksObject:function(json){
        //https://stackoverflow.com/questions/30082277/accessing-a-new-style-public-google-sheet-as-json
        console.log('parsing Google Spreadsheet');
        //console.log(json);

        for (var i = 0; i < json.feed.entry.length; i++) {
          //  This is console.log for the each row in the spreadsheet
          //console.log( json.feed.entry[i]);
          var task = json.feed.entry[i].gsx$prompt.$t;
          var timePrep =  5000;//json.feed.entry[i].gsx$bio.$t;
          var timePlay =  30000;//json.feed.entry[i].gsx$bio.$t;
          var time = json.feed.entry[i].gsx$time.$t;
          var players = json.feed.entry[i].gsx$highplayers.$t;
          var playersMax = json.feed.entry[i].gsx$highplayers.$t;


          //var time;//10000;//json.feed.entry[i].gsx$bio.$t;
          // if(json.feed.entry[i].gsx$time.$t == ''){
          //  time = '2';
          //} else {
          //  playersMin = json.feed.entry[i].gsx$time.$t;
          //}


          var playersMin;
          if(json.feed.entry[i].gsx$lowplayers.$t == ''){
            playersMin = '2';
          } else {
            playersMin = json.feed.entry[i].gsx$lowplayers.$t;
          }

          console.log(playersMin);

          //Object
          var tempObject = {
            task: task.replace(/^\s+|\s+$/g, ""),
            timePrep: timePrep,
            timePlay: timePlay,
            time: time.replace(/^\s+|\s+$/g, ""),
            players: players.replace(/^\s+|\s+$/g, ""),
            playersMin: playersMin.replace(/^\s+|\s+$/g, ""),
            playersMax: playersMax.replace(/^\s+|\s+$/g, "")

          }

          // Make a newly formatted Master List/Array
          // of all of the projects
          allTasks.push(tempObject);

        //marker.setVisible(true);
        }
        console.log('parsed Google Spreadsheet');


    }
}


/*******************
     Setup
********************/
$(document).ready(function(){ //somethimes this fires twice for whatever reason...
  console.log('load');
  gameProjection.convertSpreadsheetToTasksObject(json);
  gameProjection.init();
  //gameProjection.setupDebugTimes();
  //gameProjection.setupDebugPrompts();
  gameProjection.draw()
});




function backgroundDecoration(path){
  this.image = loadImage(path)
  this.x = getThird()
  this.y = random(height)
  this.sz = random(75,100)
  this.speed = random(0.1,0.5)

  this.display = function(){
    image(this.image,this.x,this.y,this.sz,this.sz)
    this.y += this.speed
    if(this.y > height){
      this.y = -this.sz
      this.x = getThird()
    }
  }

}

function getThird(){
  var location
  if(random(1)> 0.5){
    location = random(0, width/3-75)
  }else{
    location = random(width/3*2, width-75)
  }
  return location;
}

/*******************
  ANIMATED BACKGROUND
********************/
var avatars = []
var decorations = []
// var count = 0
// var cell = 200
// var numAvatars = 30
// var positions = []
var sound;
var soundReverse;
function preload(){
  sound = loadSound('assets/audio/pop.mp3');
  soundReverse = loadSound('assets/audio/popReverse.mp3');
}

function setup() {
  pixelDensity(1);


  createCanvas(windowWidth,windowHeight)
  //for (var i = 0; i < 30; i++) {
    // var a = loadImage('avatars/'+ Math.ceil(Math.random()*294)+'.png')
  //}

  for (var i = 1; i <= 8; i++) {
    d = new backgroundDecoration('../assets/images/projection-decoration/'+ GAME_LOCATION +'/' + i + '.png')
    decorations.push(d)
  }

  for (var i = 1; i <= 20; i++) {

  var a = new avatar('../assets/images/avatarsHalfSize/'+ceil(random(1,300))+'.png', 88888888, random(0,width),random(0,height))
  avatars.push(a)
  }


}

function draw() {
  background(255)

  for (var i = 0; i < decorations.length; i++) {
    decorations[i].display()
  }


  avatars.sort(function(a, b) {
    return (a.y-a.avatarHeight) - (b.y-a.avatarHeight)
  })

  for (var i = 0; i < avatars.length; i++) {
    avatars[i].display();
    if(avatars[i].readyRemove == true){avatars.splice(i, 1); }
  }


}
function collidePointRect (pointX, pointY, x, y, xW, yW) {
//2d
if (pointX >= x &&         // right of the left edge AND
    pointX <= x + xW &&    // left of the right edge AND
    pointY >= y &&         // below the top AND
    pointY <= y + yW) {    // above the bottom
        return true;
}
return false;
};

function perlin() {
  let i = 0;
  let n = random(100);
  return ()=>{
    n += 0.0004;

    //i = (i + 1) % 2;

    let noiseT = i + n;
    //noiseT = noiseT % 1.0;
    var ret = noise(noiseT); //(0,1)
    //ret = (ret - .5) * 2; //(-1,1)
    //console.log(ret)
    return ret;
  }
}
function easeOutBounce(t, b, c, d) {
    if ((t /= d) < (1 / 2.75)) {
        return c * (7.5625 * t * t) + b;
    } else if (t < (2 / 2.75)) {
        return c * (7.5625 * (t -= (1.5 / 2.75)) * t + .75) + b;
    } else if (t < (2.5 / 2.75)) {
        return c * (7.5625 * (t -= (2.25 / 2.75)) * t + .9375) + b;
    } else {
        return c * (7.5625 * (t -= (2.625 / 2.75)) * t + .984375) + b;
    }
}

function easeInOutElastic(t, b, c, d) {
    var a, p, s;
    s = 1.70158;
    p = 0;
    a = c;
    if (t === 0) {
      b;
    } else if ((t /= d / 2) === 2) {
      b + c;
    }
    if (!p) {
      p = d * (0.3 * 1.5);
    }
    if (a < Math.abs(c)) {
      a = c;
      s = p / 4;
    } else {
      s = p / (2 * Math.PI) * Math.asin(c / a);
    }
    if (t < 1) {
      return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
    } else {
      return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;
    }
  }


  function easeInElastic(t, b, c, d) {
    var a, p, s;
    s = 1.70158;
    p = 0;
    a = c;
    if (t === 0) {
      b;
    } else if ((t /= d) === 1) {
      b + c;
    }
    if (!p) {
      p = d * 0.3;
    }
    if (a < Math.abs(c)) {
      a = c;
      s = p / 4;
    } else {
      s = p / (2 * Math.PI) * Math.asin(c / a);
    }
    return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
  }
var startTime
var duration = 300; // animate over 1000ms
var duration2 = 700; // animate over 1000ms

var totChange = .99; // change the size by 25%


function avatar(path,id,x,y){
  this.id = id;
  this.x = x
  this.y = y
  this.previousX = 0;
  this.previousY = 0;
  this.random = perlin()
  this.yRandom = perlin()
  this.image = loadImage(path)
  this.speed = random(0,6)
  this.waitTime = random(4,10)
  this.counter = 0;
  this.state = 'avatarIsGrowing';
  this.avatarWidth = -2;
  this.avatarHeight = 0;
  this.startTime = performance.now();
  this.endTime = this.startTime + duration;
  this.rotate = 0;
  this.angle = 0;
  this.angleCounter = 0;
  this.currentValue = 0;
  this.readyRemove = false;
  this.avatarSetup = true;

  sound.playbackRate = random(.8,1.5);
  sound.play();

  this.avatarGrow = function(){
    if (this.time >= this.endTime)
    {
      this.state = 'avatarIsWalking';
    }

    var elapsed =  this.time - this.startTime;
    var value = easeOutBounce(elapsed, .001, totChange, duration);

    if(value > .99){ value = 0.99; } // This is required from keep the tween from increasing too far
    this.currentValue =value; // this is needed to reverse the tween.

    this.avatarWidth = (this.image.width) * value/3;
    this.avatarHeight = (this.image.height) * value/3;//
  },
  this.avatarShrink = function(){
    if (this.time >= this.endTime)
    {
      this.state = 'avatarIsWalking';
      this.readyRemove = true;
    }

    var elapsed =  this.time - this.startTime;
    var value = easeInOutElastic(elapsed, this.currentValue, -this.currentValue, duration2);

    if(value < 0){ value = 0.000001; } // This is required from keep the tween from reversing too far

    this.avatarWidth = (this.image.width) * (value/3);
    this.avatarHeight = (this.image.height) * (value/3);//
  },
  this.calculateSpeed = function(){
      this.speed = abs(this.x - this.previousX) + abs(this.y - this.previousY);
      //speed = speed;
      //console.log(speed);
      this.previousX = this.x;
      this.previousY = this.y;
  },
  this.display = function(){
    console.log()

    this.time = performance.now();

    while (this.avatarSetup){
      this.x = constrain( map(this.random(),0,1, -.5,1.5) * width, 0 - this.avatarWidth, width + this.avatarWidth ) ;//constrain(this.x + this.random()*4, 0, width - (this.image.width/2));
      this.y = constrain( map(this.yRandom(), 0, 1, -.5, 1.5) * height, 0 - this.avatarHeight , height + this.avatarHeight );//constrain(this.y + this.random()*4, 0, height - (this.image.height/2));

      if(!collidePointRect(this.x,this.y,(500-100),0,(680+100),860)) {
            /*
            After it checks to see if the position is in the middle
            it then checks to see if the x and y are inside the screen
            I offset the detection by 100 for x and 200 for y
            We could not use the avatar width or height because
            of the animation they start at 0 or 1 pixel so the offset is so small
            // that they would still appear offscreen
            */
            if(this.x > 100 && this.x < windowWidth - 100 &&
              this.y > 200 && (this.y) < windowHeight - 200){
            console.log('x:'+this.x + ' y:'+this.y )

            this.avatarSetup =false;
            break;
          }
       }
    }

    this.x = constrain( map(this.random(),0,1, -.5,1.5) * width, 0 - this.avatarWidth, width + this.avatarWidth ) ;//constrain(this.x + this.random()*4, 0, width - (this.image.width/2));
    this.y = constrain( map(this.yRandom(), 0, 1, -.5, 1.5) * height, 0 - this.avatarHeight , height + this.avatarHeight );//constrain(this.y + this.random()*4, 0, height - (this.image.height/2));


    if(this.image.width != 1){ // this necessary until the image is loaded

      switch(this.state) {
        case 'avatarIsGrowing':
          this.avatarGrow();
          break;
        case 'avatarIsShrinking':
          this.avatarShrink();
          break;
        case 'avatarIsWalking':
          //this.avatarShrink();
          break;
      }

      this.calculateSpeed();

      var angle = sin(this.angleCounter * 2 * PI); //-1, 1
      angle =  round(angle * 1) / 1; // snap
      angle *= .75;

      var bounceOffset = sin((this.angleCounter + .25) * 2 * 2 * PI);
      //bounceOffset =  round(bounceOffset * 1) / 1; // snap
      bounceOffset *= 1.75;

      push();
      translate(this.x,this.y + bounceOffset);
      rotate(radians(angle));
      image(this.image,0-(this.avatarWidth/2),0-(this.avatarHeight),this.avatarWidth,this.avatarHeight);
      pop();


      var dT = (1/30.0); //delta time
      //console.log(speed);
      var animSpeed = map(this.speed, 0, 1, .6, .75);
      this.angleCounter = (this.angleCounter + dT * animSpeed);



    }
  }
}

function lerp(t, minn, maxx)
{
  return(t, 0, 1, minn, maxx);
}

function mousePressed() {
    //var a = new avatar('avatars/'+ Math.ceil(Math.random()*294)+'.png', random(0,width),random(0,height) )
    //avatars.push(a)
}

function keyPressed() {
  if (keyCode === LEFT_ARROW) {
     for (var i = 0; i < avatars.length; i++) {

       // if(avatars[i].id == 'aaa'){
          avatars[i].state = 'avatarIsShrinking';
          avatars[i].startTime = performance.now();
          avatars[i].endTime = avatars[i].startTime + duration2;
          soundReverse.playbackRate = random(.8,1.5);
          soundReverse.play();
      //}
        }
  }
}


