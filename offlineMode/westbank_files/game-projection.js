/**
 * Represents a search trough an array.
 * @function search
 * @param {Array} array - The array you wanna search trough
 * @param {string} key - The key to search for
 * @param {string} [prop] - The property name to find it in
 */


var json = {"version":"1.0","encoding":"UTF-8","feed":{"xmlns":"http://www.w3.org/2005/Atom","xmlns$openSearch":"http://a9.com/-/spec/opensearchrss/1.0/","xmlns$gsx":"http://schemas.google.com/spreadsheets/2006/extended","id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"WestBank - Ramadan Contemplative"},"link":[{"rel":"alternate","type":"application/atom+xml","href":"https://docs.google.com/spreadsheets/d/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/pubhtml"},{"rel":"http://schemas.google.com/g/2005#feed","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full"},{"rel":"http://schemas.google.com/g/2005#post","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full"},{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full?alt\u003djson-in-script"}],"author":[{"name":{"$t":"ben"},"email":{"$t":"ben@benmoren.com"}}],"openSearch$totalResults":{"$t":"35"},"openSearch$startIndex":{"$t":"1"},"entry":[{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cokwr"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be a buzzing bee or a wildflower. Wildflowers: Open your petals wide to invite bees to land! Bees: buzz, fly, and find flowers to land on and pollinate!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cokwr"}],"gsx$prompt":{"$t":"Choose to be a buzzing bee or a wildflower. Wildflowers: Open your petals wide to invite bees to land! Bees: buzz, fly, and find flowers to land on and pollinate!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cpzh4"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Starting from a crouch on the ground, perform air temperature rising and falling, slowly, and then quickly!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cpzh4"}],"gsx$prompt":{"$t":"Starting from a crouch on the ground, perform air temperature rising and falling, slowly, and then quickly!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cre1l"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: close your eyes, be silent, and listen closely to the space around you. "},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000, notes: All"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cre1l"}],"gsx$prompt":{"$t":"Everyone: close your eyes, be silent, and listen closely to the space around you. "},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":"All"}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/chk2m"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Link hands to form a winding river. Can you flow to the ocean?"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/chk2m"}],"gsx$prompt":{"$t":"Link hands to form a winding river. Can you flow to the ocean?"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ciyn3"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: Be a tree seed floating in the air. How do you move? How far can you go?"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000, notes: all"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ciyn3"}],"gsx$prompt":{"$t":"Everyone: Be a tree seed floating in the air. How do you move? How far can you go?"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":"all"}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ckd7g"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Cluster together as a group and become the sun. Use your arms and legs to form rays of light. Shine brightly!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ckd7g"}],"gsx$prompt":{"$t":"Cluster together as a group and become the sun. Use your arms and legs to form rays of light. Shine brightly!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/clrrx"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"An old growth tree has just been logged. Gather tightly together to be rings in the tree's trunk. "},"content":{"type":"text","$t":"lowplayers: 10, highplayers: 12, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/clrrx"}],"gsx$prompt":{"$t":"An old growth tree has just been logged. Gather tightly together to be rings in the tree's trunk. "},"gsx$lowplayers":{"$t":"10"},"gsx$highplayers":{"$t":"12"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cyevm"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are all coral living in a reef. Crouch together on the ground, using your bodies to make funky coral shapes!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cyevm"}],"gsx$prompt":{"$t":"You are all coral living in a reef. Crouch together on the ground, using your bodies to make funky coral shapes!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cztg3"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Be trees! Wave your branches and leaves around to capture CO2 as the world warms around you!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cztg3"}],"gsx$prompt":{"$t":"Be trees! Wave your branches and leaves around to capture CO2 as the world warms around you!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d180g"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Link arms to become wide, heavy stratus clouds drifting together, shielding the ground below you from the sun's heat."},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d180g"}],"gsx$prompt":{"$t":"Link arms to become wide, heavy stratus clouds drifting together, shielding the ground below you from the sun's heat."},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d2mkx"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Holding hands, become wispy cirrus clouds, pushing the Earth's heat back to the ground!"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d2mkx"}],"gsx$prompt":{"$t":"Holding hands, become wispy cirrus clouds, pushing the Earth's heat back to the ground!"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cssly"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Bunch together as fluffy cumulus clouds. Float around together, pushing heat up into the sky and down to the ground."},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cssly"}],"gsx$prompt":{"$t":"Bunch together as fluffy cumulus clouds. Float around together, pushing heat up into the sky and down to the ground."},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cu76f"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are electrons in a solar panel. Spin and flow as you generate electricity!"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cu76f"}],"gsx$prompt":{"$t":"You are electrons in a solar panel. Spin and flow as you generate electricity!"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cvlqs"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Wind turbines: stand motionless in the still air. Wind: rush up and turn their blades! How fast can they go?"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cvlqs"}],"gsx$prompt":{"$t":"Wind turbines: stand motionless in the still air. Wind: rush up and turn their blades! How fast can they go?"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cx0b9"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are new leaves unfolding into the world. Use your body to make different shapes. Are you an oak leaf? A pine needle?"},"content":{"type":"text","$t":"lowplayers: 2, highplayers: 5, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/cx0b9"}],"gsx$prompt":{"$t":"You are new leaves unfolding into the world. Use your body to make different shapes. Are you an oak leaf? A pine needle?"},"gsx$lowplayers":{"$t":"2"},"gsx$highplayers":{"$t":"5"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d9ney"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A pod of minke whales finally finds krill to eat underneath shrinking Arctic sea ice. Together, form a whale's large mouth and scoop up krill!"},"content":{"type":"text","$t":"lowplayers: 5, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d9ney"}],"gsx$prompt":{"$t":"A pod of minke whales finally finds krill to eat underneath shrinking Arctic sea ice. Together, form a whale's large mouth and scoop up krill!"},"gsx$lowplayers":{"$t":"5"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/db1zf"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are a group of krill larvae living underneath ice in the Arctic. Crawl around, using your tiny pincers to eat algae off the ice. Yum!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/db1zf"}],"gsx$prompt":{"$t":"You are a group of krill larvae living underneath ice in the Arctic. Crawl around, using your tiny pincers to eat algae off the ice. Yum!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dcgjs"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Together, you are the Mississippi River in a thunderstorm. Use your bodies to be the river rising, speeding up, and flooding. What do the thunderstorm sound like?"},"content":{"type":"text","$t":"lowplayers: 8, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dcgjs"}],"gsx$prompt":{"$t":"Together, you are the Mississippi River in a thunderstorm. Use your bodies to be the river rising, speeding up, and flooding. What do the thunderstorm sound like?"},"gsx$lowplayers":{"$t":"8"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ddv49"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"You are tadpoles hatching from eggs. Swim fast to the shore, then grow legs and hop onto the land!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/ddv49"}],"gsx$prompt":{"$t":"You are tadpoles hatching from eggs. Swim fast to the shore, then grow legs and hop onto the land!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d415a"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Baby humpback whales whisper to their mothers to stay safe from listening predators, but human noise pollution makes it hard for the mothers to hear them. Choose to be a baby whale, a mother whale, or a predator swimming about. Can you hear eachother? "},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 3, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d415a"}],"gsx$prompt":{"$t":"Baby humpback whales whisper to their mothers to stay safe from listening predators, but human noise pollution makes it hard for the mothers to hear them. Choose to be a baby whale, a mother whale, or a predator swimming about. Can you hear eachother? "},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"3"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d5fpr"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One of the largest organisms in the world is a grove of 47,000 aspen trees, all connected by the same root system. Everyone: Link arms with the people next to you until the entire crowd is joined as one organism!"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000, notes: all"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d5fpr"}],"gsx$prompt":{"$t":"One of the largest organisms in the world is a grove of 47,000 aspen trees, all connected by the same root system. Everyone: Link arms with the people next to you until the entire crowd is joined as one organism!"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":"all"}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d6ua4"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Link arms in the shape of a solar panel. The sun (one person) appears. Solar panel: buzz and vibrate with energy production!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d6ua4"}],"gsx$prompt":{"$t":"Link arms in the shape of a solar panel. The sun (one person) appears. Solar panel: buzz and vibrate with energy production!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d88ul"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"A group of toads jump around in a swamp, calling for mates. Can you be the loudest?"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/d88ul"}],"gsx$prompt":{"$t":"A group of toads jump around in a swamp, calling for mates. Can you be the loudest?"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dkvya"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Link arms as a cluster of leaves in a tree. Autumn finally arrives; break apart and drift to the ground, twirling as you fall."},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dkvya"}],"gsx$prompt":{"$t":"Link arms as a cluster of leaves in a tree. Autumn finally arrives; break apart and drift to the ground, twirling as you fall."},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dmair"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"It's autumn and you are crunchy leaves on the ground. A gust of wind comes up suddenly. Roll and swirl around!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dmair"}],"gsx$prompt":{"$t":"It's autumn and you are crunchy leaves on the ground. A gust of wind comes up suddenly. Roll and swirl around!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dnp34"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: You are the wind! Sway back and forth, and use your voices to make the sounds of the wind–whoosh! shhh!"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dnp34"}],"gsx$prompt":{"$t":"Everyone: You are the wind! Sway back and forth, and use your voices to make the sounds of the wind–whoosh! shhh!"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dp3nl"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One person is the sun, a group is a field of sunflowers. Sunflowers: follow the sun as it rises and sets to absorb energy."},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dp3nl"}],"gsx$prompt":{"$t":"One person is the sun, a group is a field of sunflowers. Sunflowers: follow the sun as it rises and sets to absorb energy."},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/df9om"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: Together you are the sun; act like solar flares! How big and bright can you be?"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/df9om"}],"gsx$prompt":{"$t":"Everyone: Together you are the sun; act like solar flares! How big and bright can you be?"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dgo93"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Use your bodies to perform a volcano erupting. Flow like lava or fly like ash!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 10, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dgo93"}],"gsx$prompt":{"$t":"Use your bodies to perform a volcano erupting. Flow like lava or fly like ash!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"10"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/di2tg"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Everyone: Hum like mosquitos!"},"content":{"type":"text","$t":"lowplayers: all, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/di2tg"}],"gsx$prompt":{"$t":"Everyone: Hum like mosquitos!"},"gsx$lowplayers":{"$t":"all"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/djhdx"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"One person is a hapless hiker. Ticks attack and latch! "},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 5, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/djhdx"}],"gsx$prompt":{"$t":"One person is a hapless hiker. Ticks attack and latch! "},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"5"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dw4je"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Butterflies wake up after a chilly night. Spread your wings to warm them in the morning sun, then fly to flowers for breakfast!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dw4je"}],"gsx$prompt":{"$t":"Butterflies wake up after a chilly night. Spread your wings to warm them in the morning sun, then fly to flowers for breakfast!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dxj3v"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Choose to be trees or wind. Wind: leap, whoosh, tickle, slide! Trees: sway back and forth together, wave your branches!"},"content":{"type":"text","$t":"lowplayers: 4, highplayers: 8, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dxj3v"}],"gsx$prompt":{"$t":"Choose to be trees or wind. Wind: leap, whoosh, tickle, slide! Trees: sway back and forth together, wave your branches!"},"gsx$lowplayers":{"$t":"4"},"gsx$highplayers":{"$t":"8"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dyxo8"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Form the Earth's internal layers. Each person line up in order: continental crust, oceanic crust, upper mantle, lower mantle, outer core, inner core. "},"content":{"type":"text","$t":"lowplayers: 6, highplayers: 6, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/dyxo8"}],"gsx$prompt":{"$t":"Form the Earth's internal layers. Each person line up in order: continental crust, oceanic crust, upper mantle, lower mantle, outer core, inner core. "},"gsx$lowplayers":{"$t":"6"},"gsx$highplayers":{"$t":"6"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}},{"id":{"$t":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/e0c8p"},"updated":{"$t":"2017-06-10T07:26:40.894Z"},"category":[{"scheme":"http://schemas.google.com/spreadsheets/2006","term":"http://schemas.google.com/spreadsheets/2006#list"}],"title":{"type":"text","$t":"Join hands and become the wind. Rush and swirl around, making gusting noises as you go!"},"content":{"type":"text","$t":"lowplayers: 3, highplayers: all, time: 30000"},"link":[{"rel":"self","type":"application/atom+xml","href":"https://spreadsheets.google.com/feeds/list/1SojNwKJj8V0vas9-3jM-ji9UjUa4gMi45ZtOmoofDUM/2/public/full/e0c8p"}],"gsx$prompt":{"$t":"Join hands and become the wind. Rush and swirl around, making gusting noises as you go!"},"gsx$lowplayers":{"$t":"3"},"gsx$highplayers":{"$t":"all"},"gsx$time":{"$t":"30000"},"gsx$notes":{"$t":""}}]}}


var searchResults;




function search(array, key, prop){
    // Optional, but fallback to key['name'] if not selected
    prop = (typeof prop === 'undefined') ? 'name' : prop;
    var tempArray = [];
    for (var i=0; i < array.length; i++) {
        // console.log(array[i][prop]);
        //if (array[i][prop] <= Maxkey && array[i][prop] >= minkey) {
        if (array[i][prop] <= key) {
            tempArray.push(array[i]);
        } else if(array[i][prop] == 'all'){
            tempArray.push(array[i]);
        }
    }
    return tempArray;
}

var allTasks = []


function moreDetails(click){
     var $this = null;
     // check if object is jquery object
     if(click instanceof jQuery){
          $this = click;
     } else {
          // this is a javascript object
          $this = $('#'+click.id);
     }
     var href = $this.attr("href");
     var hash = href.substr(1);

     if($this.hasClass('artwork')){
          showArtworkClose();

          console.log('artwork');

          // Get project desc panel and send it to marker as visited function
          var $thisProject = $this.parents('.project-slide-panel');
          //setMarkerAsVisited($thisProject);


          //console.log($this.attr('data-project-url'));
          var projectUrl = $this.attr('data-project-url');
          var $iframe = $('.iframe.project-slide-panel');
          //customProblemsAndFixesArtwork($('.slideUp.project-slide-panel'));

          //Set Panel from display none to display block
          $iframe.css('display','block');

          //Set Panel src
          $iframe.attr('src',projectUrl);

          //If we don't set a slight timeout the css animation won't work.
          setTimeout(function(){
            $iframe.addClass('slideUp');
          },100);

        }  else {

                    //Set Panel from display none to display block
                    $('.page.'+hash).css('display','block');

                    //If we don't set a slight timeout the css animation won't work.
                    setTimeout(function(){
                         $('.page.'+hash).addClass('slideUp');
                    },100);

                    var currentPageImage = $('.project-slide-panel.'+hash).find('.location-image-large');
                    var currentPage = $('.project-slide-panel.'+hash);
                    var currentImage = currentPage.attr('data-image')
                   if(currentPageImage.length){
                     $('<img/>').attr('src', '/assets/images/locations/'+currentImage+'-large.jpg').load(function() {
                      $(this).remove(); // prevent memory leaks as @benweet suggested
                      currentPageImage.css('background-image', 'url(/assets/images/locations/'+currentImage+'-large.jpg)');
                      currentPageImage.delay(700).velocity({opacity: 1},600);
                     });
                   }

           }
}

function slideDownPanel(link){
     var $this = link;

     if($this.hasClass('artwork')){
          var $iframe = $('.iframe.project-slide-panel');
          hideArtworkClose();

          $iframe.velocity({opacity: 0}, 150, function(){

            setTimeout(function(){
              $iframe.css('display','none');
              $iframe.attr('src', $iframe.attr('data-fake-src'));
              $iframe.removeClass('slideUp');

              setTimeout(function(){
                $iframe.removeClass('white'); // This is a fix for some of the projects
                $('.close.artwork').removeClass('black'); // This is a fix for some of the projects
                $iframe.css('opacity','1');
              },1);

            }, 1);



          });


        } else {
     if($this.parent('.nav').parent('.page').hasClass('sign-up')){
          $('#carousel-sign-up').carousel(0);
     }
     $this.parent('.nav').parent('.page').removeClass('slideUp');
     setTimeout(function(){
       $this.parent('.nav').parent('.page').css('display','none');
     }, 750);

     }
}

/**********************
Globals
**********************/
if(SETTINGS.server == 'localhost'){
    socket = io('http://localhost:3000');
} else if(SETTINGS.server == 'server-http'){
    //console.log = function() {}
    socket = io('http://joincollectiveaction.com:3000');
} else if(SETTINGS.server == 'server-https'){
   //console.log = function() {}
   socket = io('https://joincollectiveaction.com:3000', { secure : true});
}

//var socket = io('http://localhost:3000'); //MAKE SSURE TO CHANGE THIS TO THE SERVER'S IP LATER!
//var socket = io('https://joincollectiveaction.com:3000', { secure : true}); //MAKE SSURE TO CHANGE THIS TO THE SERVER'S IP LATER!


//reload the view when the app boots up & this page connects


// var time;

// const GAME_LOCATION = 'location1' ///////////IMPORTANT ***** SET GAME LOCATION IN game-projection.hbs

/**********************
Helper Functions
**********************/
function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min)) + min;
}



var gameProjection = {
     bodyElement: $('body'),
     currentNumberOfConnections:100,
     requestedNumberOfConnections: false,
     currentPlayers:null,
     requestedCurrentPlayers: 100,
     currentTask:null,

     requestedTask: false,
     prepFrameCounter:0,
     taskFrameCounter:0,
     numberOfTimesGetDataHasRun: 0,
     wait:15000,
     state:'title',
     gameStateIndex:0,

     // Time Variables
     TimeTitle: 15000,
     TimeHighscoresPlayers:10000,
     TimeHighscoresTeams:10000,
     TimeGetNumberOfConnectionsTaskPlayers:500,
     TimeSetupGame:500,
     TimeInviteToPerformanceArea: 5000,
     TimeWeNeedMorePlayers: 5000,
     TimePrepForTask: 15000,
     TimeStartTask: 30000,
     TimeEndTask: 8000,
     TimeEndScore: 7000,
     TimeReset: 250,
     avatarLimit:100,
     taskPlayedCounter: 1,
     //gameStates:['highscore players','highscore team','teaser','get players','get task','start task'],
     init: function(){
          //gameProjection.addLocationClassToBody();

           $('#movie-intro').get(0).play()

          time = new Date().getTime();//store the current time
          // this.getNewTask();
          // this.newGame()

          // socket.on('connect', function(){
          //     console.log('connected to the server as: ' + socket.id);
          //
          //     socket.emit('joinProjectinoRoom', GAME_LOCATION) //join my own room!
          //
          //     //reset state on page refresh / re-connect of game-projection
          //     socket.emit('resetRoomClients', GAME_LOCATION);
          //
          //     setTimeout(function(){ // This is here for a weird problem for when the projections crashes and you need to reload the page this is here to make sure it gets the already connected users.
          //       socket.emit('getAllUsers',GAME_LOCATION, function(users){
          //           users.forEach(function(user){
          //             if(avatars.length >= gameProjection.avatarLimit){
          //               return;
          //             } else {
          //               var a = new avatar('assets/images/avatarsHalfSize/'+user.userObject.avatar+'', user.id, random(0,width),random(0,height))
          //               avatars.push(a)
          //             }
          //           })
          //
          //       })
          //     },1500);
          // });

          //gameProjection.parseTitleUrlParamater();
          //socket.on('disconnect', function(){
          //     console.log('disconnected from the server as: ' + socket.id);
          //});

         //socket.on('addAvatar',function(user){
         //  console.log('addAvatar',user);
         //  if(avatars.length >= gameProjection.avatarLimit){
         //    return;
         //  } else {
         //    var a = new avatar('assets/images/avatarsHalfSize/'+user.userObject.avatar+'', user.id, random(0,width),random(0,height))
         //    avatars.push(a)
         //  }
         //})
         //socket.on('removeAvatar',function(user){
         //  console.log('removeAvatar',user);

         //  for (var i = 0; i < avatars.length; i++) {

         //     if(avatars[i].id == user.id){
         //       avatars[i].state = 'avatarIsShrinking';
         //       avatars[i].startTime = performance.now();
         //       avatars[i].endTime = avatars[i].startTime + duration2;
         //       soundReverse.playbackRate = random(.8,1.5);
         //       soundReverse.play();
         //     }
         //  }

         //})

     },
     addLocationClassToBody:function(){
      $('body').addClass(GAME_LOCATION);
     },
     parseTitleUrlParamater:function(){
      var title = $('.location-title').text();
      var titleElement = $('.location-title')
      var titleIcon = $('.location-icon')
      var urlForIcons = 'assets/images/projections/location-icons/'
      switch (title) {
        case 'commons':
            titleIcon.attr('src',urlForIcons+'icon_commons.png');
            titleElement.html('Commons');
            break;
        case 'westbank':
            titleIcon.attr('src',urlForIcons+'icon_cedarriverside.png');
            titleElement.html('Westbank');
            break;
        case 'littleafrica':
            titleIcon.attr('src',urlForIcons+'icon_littleafrica.png');
            titleElement.html('Little Africa');
            break;
        case 'rondo':
            titleIcon.attr('src',urlForIcons+'icon_rondo.png');
            titleElement.html('Rondo');
            break;
        case 'littlemekong':
            titleIcon.attr('src',urlForIcons+'icon_littlemekong.png');
            titleElement.html('Little Mekong');
            break;
        case 'lowertown':
            titleIcon.attr('src',urlForIcons+'icon_lowertown.png');
            titleElement.html('Lowertown');
            break;
      }
     },
     changeState:function(string){
      gameProjection.state = string;
     },
     setStateAndTime:function(state, waitTime){
      var self = this;
      console.log(state);
      if(state != 'get-number-of-connections-task-players' && state != 'get-number-of-connections' && state != 'get-task' && state != 'get-players'){
        slideDownPanel($('.page.slideUp .close'));
        moreDetails($('.page.'+state+' .nav a'));
      }
      if($('body').hasClass('warning')){
        $('body').removeClass('warning');
      }
      self.state = state;
      self.wait = waitTime
     },
     removeBodyClassForAnimatedBackground:function(){
      var self = this;
      if(self.bodyElement.hasClass('warning')){
        self.bodyElement.removeClass('warning');
      }
     },
     animateBackgroundForLowTime:function(){
      var self = this;
      var prepTime = Math.floor(self.TimePrepForTask/1000 - (self.prepFrameCounter/60));
      var taskTime = Math.floor(self.TimeStartTask/1000 - (self.taskFrameCounter/60));

      if(taskTime < 10 && self.state == 'start-task'){
        self.bodyElement.addClass('warning');
      } else if(prepTime < 10 && self.state == 'prep-for-task'){
        self.bodyElement.addClass('warning');
      }
     },
     reset:function(){
      var self = this;
      //self.currentNumberOfConnections = null;
      //self.requestedNumberOfConnections = false;
      //self.currentPlayers = null;
      //self.requestedCurrentPlayers = false;
      //self.currentTask = null;
      //self.requestedTask = false;

      self.prepFrameCounter = 0;
      self.taskFrameCounter = 0;
      console.log('reset');
      //self.numberOfTimesGetDataHasRun = 0;
      self.taskPlayedCounter;
     },
     writeInvitionToScreen:function(){
        var textBox = $('.invite-to-performance-area .container .inner-container p');
        var self = this;
        var text = 'Players: Come on up!'
        if(self.currentTask.playersMax == 'all'){
          text = 'Everyone: Get Ready!'
        }
        textBox.html(text);
     },
      checkTimer:function(){
           var self = this;
           if(new Date().getTime() - time >= self.wait) {
                console.log("tick2");//if it is, do something
                time = new Date().getTime();//also update the stored time
                switch (self.state) {
                  case 'title':
                      self.hideIntroVideo();
                      self.getTask();
                      self.setStateAndTime('setup-game', self.TimeSetupGame); // OFFLINE MODE
                      //self.setStateAndTime('highscores-players', self.TimeHighscoresPlayers);
                      self.writeHighScoresToScreen();

                      // self.refreshConnectedBackgroundAvatars();
                      break;
                  case 'highscores-players':

                      //self.setStateAndTime('highscores-teams', self.TimeHighscoresTeams);
                      self.writeTeamScoresToScreen()
                      break;
                  case 'highscores-teams':
                      self.setStateAndTime('get-number-of-connections-task-players', self.TimeGetNumberOfConnectionsTaskPlayers);
                      break;
                  case 'get-number-of-connections-task-players':
                      self.checkIfNumberOfConnectionsIsEmptyAndGet();
                      self.checkIfTaskIsEmptyAndGet();
                      self.checkIfPlayersIsEmptyAndGet();
                      if(self.currentNumberOfConnections != null && self.currentTask != null && self.currentPlayers != null && allTasks.length > 0){
                        self.setStateAndTime('setup-game', self.TimeSetupGame);
                      } else if(self.currentNumberOfConnections <= 1 && self.currentTask != null && self.currentPlayers <= 1 && allTasks.length > 0){
                        console.log('333!!!!!!!!!!!!!!!!!!!!!')
                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                      } else if(self.numberOfTimesGetDataHasRun > 15) {
                        //console.log('444!!!!!!!!!!!!!!!!!!!!!')

                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                        self.reset();
                        self.numberOfTimesGetDataHasRun = 0; // Maybe this should be self.reset();
                      } else {
                        self.setStateAndTime('get-number-of-connections-task-players', 100);
                        self.numberOfTimesGetDataHasRun++;
                      }
                      break;
                  case 'setup-game':
                      // self.newGame();
                      self.writeTaskToScreen();
                      self.writeInvitionToScreen();
                      $('#sound-call-people')[0].play();
                      self.setStateAndTime('invite-to-performance-area', self.TimeInviteToPerformanceArea);
                      break;
                  case 'invite-to-performance-area':
                      //check to change the screen to wait for more players if there are less than 2.
                      if(self.currentNumberOfConnections < 2) {
                        self.setStateAndTime('we-need-more-players', self.TimeWeNeedMorePlayers);
                      } else {
                        self.setStateAndTime('prep-for-task', self.TimePrepForTask);
                        $('#sound-get-ready')[0].play();
                      }
                      //var interval = 0;
                      //self.setStateAndTime('get-players', self.wait);
                      //$('.page .people ul li').each(function(){
                      //  interval = interval + 2000;
                      //  $(this).delay(interval).animate({opacity:1});
                      //});
                      break;
                  case 'we-need-more-players':
                      self.setStateAndTime('get-number-of-connections-task-players', self.TimeGetNumberOfConnectionsTaskPlayers);
                      break;
                  case 'prep-for-task':
                      // time to get ready
                      console.log(gameProjection.currentPlayers)
                      self.setStateAndTime('start-task',  self.TimeStartTask);
                      self.removeBodyClassForAnimatedBackground();
                      $('#sound-start')[0].play();
                      //self.setStateAndTime('start-task',  gameProjection.currentTask.time);
                      break;
                  case 'start-task':
                      self.setStateAndTime('end-task', self.TimeEndTask);
                      self.removeBodyClassForAnimatedBackground();
                      //$('#sound-cheers')[0].play();
                      $('#movie-great-job').get(0).play()
                      break;
                  case 'end-task':
                      //self.setStateAndTime('end-score', self.TimeEndScore);
                      self.setStateAndTime('reset', self.TimeReset);
                      break;
                  case 'end-score':
                      //self.setStateAndTime('reset', self.TimeReset);
                      break;
                  case 'reset':
                      //socket.emit('resetViews', self.currentPlayers)
                      self.reset();
                      if(gameProjection.taskPlayedCounter >= 5){
                        self.setStateAndTime('title', self.TimeTitle);
                        self.playerIntroVideo();
                        gameProjection.taskPlayedCounter = 1;
                      } else {
                      	self.getTask();
                        self.setStateAndTime('setup-game', self.TimeSetupGame);
                        gameProjection.taskPlayedCounter++
                      }


                      break;
                }
                //self.state = self.gameStates[self.gameStateIndex % 5];
                //self.gameStateIndex++;
                //gameProjection.getNewTask();
           }
      },
      hideIntroVideo:function(){
        $('#movie-intro').css('display','none');
      },
      playerIntroVideo:function(){
        $('#movie-intro').css('display','block');
        $('#movie-intro').get(0).play();
      },
      draw:function(){
          var self = gameProjection;
          requestAnimationFrame(self.draw);
          switch (self.state) {
            case 'title':
                console.log('title');
                console.log();
                //if($('#movie-intro').get(0).currentTime > 15){
                //
                //
                //}
                self.checkTimer();
                //slideDownPanel($('.page.sign-up .close'));
                break;
            case 'highscores-players':
                console.log('highscores-players');
                self.checkTimer();
                break;
            case 'highscores-teams':
                console.log('highscore team');
                self.checkTimer();
                break;
            case 'get-number-of-connections-task-players':
                console.log('get-number-of-connections-task-players');
                self.checkTimer();
                break;
            case 'setup-game':
                console.log('get-players');
                self.checkTimer();
                break;
            case 'invite-to-performance-area':
                console.log('invite-to-performance-area');
                self.checkTimer();
                break;
            case 'we-need-more-players':
                console.log('we-need-more-players');
                self.checkTimer();
                break;
            case 'prep-for-task':
                console.log('prep for task');
                self.writePrepTimeToScreen();
                self.animateBackgroundForLowTime();
                self.checkTimer();
                break;
            case 'start-task':
                // time to get ready
                console.log('start task');
                self.writeTaskTimeToScreen();
                self.animateBackgroundForLowTime();
                self.checkTimer();
                break;
            case 'end-task':
                console.log('end task');
                self.checkTimer();
                break;
            case 'end-score':
                console.log('end score');
                self.checkTimer();
                break;
            case 'reset':
                console.log('reset task');
                self.checkTimer();
                break;
          }


     },

    checkIfNumberOfConnectionsIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedNumberOfConnections == false){
        self.requestedNumberOfConnections = true;
        self.checkNumberOfConnections();
      }
    },
    checkNumberOfConnections:function(){
        gameProjection.currentNumberOfConnections = Math.ceil(Math.random()*10); // OFFLINE MODE
    },
    checkIfPlayersIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedCurrentPlayers == false && self.currentTask != null){
        self.requestedCurrentPlayers = true;
        self.getPlayers();
      }
    },
    getPlayers:function(){
      //gameProjection.currentTask.location = GAME_LOCATION;
      //socket.emit('getNewAndNotifyUsers', gameProjection.currentTask, function(chosenPlayers){
      //  console.log(chosenPlayers);
      //  gameProjection.currentPlayers = chosenPlayers;
      //}); // close getNewAndNotifyUsers
    },
    checkIfTaskIsEmptyAndGet:function(){
      var self = gameProjection;
      if (self.requestedTask == false && self.currentNumberOfConnections != null){
        self.requestedTask = true;
        self.getTask();
      }
    },
    getTask:function(){
      var numberOfPlayers = gameProjection.currentNumberOfConnections;
      searchResults = null;
      if(gameProjection.currentNumberOfConnections < 2){
        console.log('less then 2 ')
        // This need to be changed not to grab specific number of connections but only task that have a minimum number of connections
        searchResults = [];
      } else {
        console.log('more then 2 ')

        searchResults = search(allTasks, gameProjection.currentNumberOfConnections,'playersMin')
        //searchResults = allTasks[getRandomInt(0,allTasks.length)];
      }
      // console.log(ameProjection.currentTask.time);
      gameProjection.currentTask = searchResults[getRandomInt(0,searchResults.length)];
      console.log(gameProjection.currentTask.time);
      gameProjection.TimeStartTask = parseInt(gameProjection.currentTask.time);
      console.log(gameProjection.TimeStartTask);
    },
    writeTaskToScreen:function(){
      var task = gameProjection.currentTask.task;
      $('.currentTask').html(task);
    },
    writePrepTimeToScreen:function(){
      var self = this;
      self.prepFrameCounter++;
      var prepTime = Math.floor(self.TimePrepForTask/1000 - (self.prepFrameCounter/60));
      $('.prep-time').html(prepTime);
    },
    writeTaskTimeToScreen:function(){
      var self = this;
      self.taskFrameCounter++;
      var taskTime = Math.floor(self.TimeStartTask/1000 - (self.taskFrameCounter/60));
      $('.task-time').html(taskTime);
    },
    setupDebugTimes:function(){
        var self = this;
        self.TimeTitle = 1000;
        self.TimeHighscoresPlayers = 1000;
        self.TimeHighscoresTeams = 1000;
        self.TimeGetNumberOfConnectionsTaskPlayers = 500;
        self.TimeSetupGame = 500;
        self.TimeInviteToPerformanceArea = 3000;
        self.TimeWeNeedMorePlayers = 3000;
        self.TimePrepForTask = 3000;
        self.TimeStartTask = 5000;
        self.TimeEndTask = 8000;
        self.TimeEndScore = 1000;
        self.TimeReset = 250;
    },
    setupDebugPrompts(){
      var numberOfPlayers = gameProjection.currentNumberOfConnections;
      searchResults = null;
      searchResults = search(allTasks, 999,'playersMin')
      var currentTaskIndex = 0;

      gameProjection.setStateAndTime('start-task',  99999999999999);
      // console.log(ameProjection.currentTask.time);
      setInterval(function(){
        gameProjection.currentTask = searchResults[currentTaskIndex];
        gameProjection.writeTaskToScreen();
        currentTaskIndex++;
      }, 1500);
    },
    writeHighScoresToScreen:function(){
      socket.emit('getHighScoreUsers',function(results){
        console.log('highScores',results);
        var appendData = ''
        results.forEach(function(result){
          appendData += '<div><div style="float:left;width:50px;height:50px;background-image:url(assets/images/avatarsHalfSize/'+ result.avatar +');background-repeat:no-repeat;background-position:center center;background-size:contain;" ></div><p class="align-left" >' + result.userName + '</p><p class="align-right">' + result.score + '</p><div style="clear:both"></div></div>';
        })
        // console.log(appendData);
        $('.scoreBoard').html(appendData)
      })
    },
    writeTeamScoresToScreen:function(){
      socket.emit('getTeamScores',function(results){
        // console.log(results);

        results.sort(function(a, b) {
            return b.score - a.score
        })
        // console.log('😬',results);

        var appendData = ''
        results.forEach(function(result){
          var teamString =''
          if(result.team == 1){
              teamString = '<div style="color:#4baaf8"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/1.png"> Water</p> '
          }else if(result.team == 2){
              teamString = '<div style="color:#8e98f8"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/2.png"> Air</p> '
          }else if(result.team == 3){
            teamString = '<div style="color:#97c355"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/3.png"> Earth</p> '
          }else if(result.team == 4){
            teamString = '<div style="color:#e88f3d"><p class="align-left" ><img style="height:50px;margin-top:-8px;" src="assets/images/teamicons/4.png"> Fire</p> '
          }

          appendData += teamString+'<p class="align-right">' + result.score + '</p><div style="clear:both"></div></div>'
        })

        $('.teamScoreBoard').html(appendData)

      })
    },
    // refreshConnectedBackgroundAvatars:function(){
    //   socket.emit('getAllUsers', GAME_LOCATION, function(connectedUsers) {
    //     console.log('gau',connectedUsers);
    //     compiledAvatars = ''
    //     connectedUsers.forEach(function(user){
    //       //compiledAvatars+= '<img src="assets/images/avatars/'+  +'">'
    //         var id = user.userObject.id;
    //         if(avatars.filter(function(e) { return e.id == id }).length > 0){
    //           // Do nothing
    //         } else {
    //           var a = new avatar('assets/images/avatars/'+user.userObject.avatar+'',user.userObject.id, random(0,width),random(0,height),  )
    //           avatars.push(a)
    //         }
    //     })
    //     //$('.tempAvatarStorage').html(compiledAvatars)
    //   }); // close getNewAndNotifyUsers
    // },
    convertSpreadsheetToTasksObject:function(json){
        //https://stackoverflow.com/questions/30082277/accessing-a-new-style-public-google-sheet-as-json
        console.log('parsing Google Spreadsheet');
        //console.log(json);

        for (var i = 0; i < json.feed.entry.length; i++) {
          //  This is console.log for the each row in the spreadsheet
          //console.log( json.feed.entry[i]);
          var task = json.feed.entry[i].gsx$prompt.$t;
          var timePrep =  5000;//json.feed.entry[i].gsx$bio.$t;
          var timePlay =  30000;//json.feed.entry[i].gsx$bio.$t;
          var time = json.feed.entry[i].gsx$time.$t;
          var players = json.feed.entry[i].gsx$highplayers.$t;
          var playersMax = json.feed.entry[i].gsx$highplayers.$t;


          //var time;//10000;//json.feed.entry[i].gsx$bio.$t;
          // if(json.feed.entry[i].gsx$time.$t == ''){
          //  time = '2';
          //} else {
          //  playersMin = json.feed.entry[i].gsx$time.$t;
          //}


          var playersMin;
          if(json.feed.entry[i].gsx$lowplayers.$t == ''){
            playersMin = '2';
          } else {
            playersMin = json.feed.entry[i].gsx$lowplayers.$t;
          }

          console.log(playersMin);

          //Object
          var tempObject = {
            task: task.replace(/^\s+|\s+$/g, ""),
            timePrep: timePrep,
            timePlay: timePlay,
            time: time.replace(/^\s+|\s+$/g, ""),
            players: players.replace(/^\s+|\s+$/g, ""),
            playersMin: playersMin.replace(/^\s+|\s+$/g, ""),
            playersMax: playersMax.replace(/^\s+|\s+$/g, "")

          }

          // Make a newly formatted Master List/Array
          // of all of the projects
          allTasks.push(tempObject);

        //marker.setVisible(true);
        }
        console.log('parsed Google Spreadsheet');


    }
}


/*******************
     Setup
********************/
$(document).ready(function(){ //somethimes this fires twice for whatever reason...
  console.log('load');
  gameProjection.convertSpreadsheetToTasksObject(json);
  gameProjection.init();
  //gameProjection.setupDebugTimes();
  //gameProjection.setupDebugPrompts();
  gameProjection.draw()
});




function backgroundDecoration(path){
  this.image = loadImage(path)
  this.x = getThird()
  this.y = random(height)
  this.sz = random(75,100)
  this.speed = random(0.1,0.5)

  this.display = function(){
    image(this.image,this.x,this.y,this.sz,this.sz)
    this.y += this.speed
    if(this.y > height){
      this.y = -this.sz
      this.x = getThird()
    }
  }

}

function getThird(){
  var location
  if(random(1)> 0.5){
    location = random(0, width/3-75)
  }else{
    location = random(width/3*2, width-75)
  }
  return location;
}

/*******************
  ANIMATED BACKGROUND
********************/
var avatars = []
var decorations = []
// var count = 0
// var cell = 200
// var numAvatars = 30
// var positions = []
var sound;
var soundReverse;
function preload(){
  sound = loadSound('assets/audio/pop.mp3');
  soundReverse = loadSound('assets/audio/popReverse.mp3');
}

function setup() {
  pixelDensity(1);


  createCanvas(windowWidth,windowHeight)
  //for (var i = 0; i < 30; i++) {
    // var a = loadImage('avatars/'+ Math.ceil(Math.random()*294)+'.png')
  //}

  for (var i = 1; i <= 8; i++) {
    d = new backgroundDecoration('../assets/images/projection-decoration/'+ GAME_LOCATION +'/' + i + '.png')
    decorations.push(d)
  }

  for (var i = 1; i <= 20; i++) {

  var a = new avatar('../assets/images/avatarsHalfSize/'+ceil(random(1,300))+'.png', 88888888, random(0,width),random(0,height))
  avatars.push(a)
  }


}

function draw() {
  background(255)

  for (var i = 0; i < decorations.length; i++) {
    decorations[i].display()
  }


  avatars.sort(function(a, b) {
    return (a.y-a.avatarHeight) - (b.y-a.avatarHeight)
  })

  for (var i = 0; i < avatars.length; i++) {
    avatars[i].display();
    if(avatars[i].readyRemove == true){avatars.splice(i, 1); }
  }


}
function collidePointRect (pointX, pointY, x, y, xW, yW) {
//2d
if (pointX >= x &&         // right of the left edge AND
    pointX <= x + xW &&    // left of the right edge AND
    pointY >= y &&         // below the top AND
    pointY <= y + yW) {    // above the bottom
        return true;
}
return false;
};

function perlin() {
  let i = 0;
  let n = random(100);
  return ()=>{
    n += 0.0004;

    //i = (i + 1) % 2;

    let noiseT = i + n;
    //noiseT = noiseT % 1.0;
    var ret = noise(noiseT); //(0,1)
    //ret = (ret - .5) * 2; //(-1,1)
    //console.log(ret)
    return ret;
  }
}
function easeOutBounce(t, b, c, d) {
    if ((t /= d) < (1 / 2.75)) {
        return c * (7.5625 * t * t) + b;
    } else if (t < (2 / 2.75)) {
        return c * (7.5625 * (t -= (1.5 / 2.75)) * t + .75) + b;
    } else if (t < (2.5 / 2.75)) {
        return c * (7.5625 * (t -= (2.25 / 2.75)) * t + .9375) + b;
    } else {
        return c * (7.5625 * (t -= (2.625 / 2.75)) * t + .984375) + b;
    }
}

function easeInOutElastic(t, b, c, d) {
    var a, p, s;
    s = 1.70158;
    p = 0;
    a = c;
    if (t === 0) {
      b;
    } else if ((t /= d / 2) === 2) {
      b + c;
    }
    if (!p) {
      p = d * (0.3 * 1.5);
    }
    if (a < Math.abs(c)) {
      a = c;
      s = p / 4;
    } else {
      s = p / (2 * Math.PI) * Math.asin(c / a);
    }
    if (t < 1) {
      return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
    } else {
      return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;
    }
  }


  function easeInElastic(t, b, c, d) {
    var a, p, s;
    s = 1.70158;
    p = 0;
    a = c;
    if (t === 0) {
      b;
    } else if ((t /= d) === 1) {
      b + c;
    }
    if (!p) {
      p = d * 0.3;
    }
    if (a < Math.abs(c)) {
      a = c;
      s = p / 4;
    } else {
      s = p / (2 * Math.PI) * Math.asin(c / a);
    }
    return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
  }
var startTime
var duration = 300; // animate over 1000ms
var duration2 = 700; // animate over 1000ms

var totChange = .99; // change the size by 25%


function avatar(path,id,x,y){
  this.id = id;
  this.x = x
  this.y = y
  this.previousX = 0;
  this.previousY = 0;
  this.random = perlin()
  this.yRandom = perlin()
  this.image = loadImage(path)
  this.speed = random(0,6)
  this.waitTime = random(4,10)
  this.counter = 0;
  this.state = 'avatarIsGrowing';
  this.avatarWidth = -2;
  this.avatarHeight = 0;
  this.startTime = performance.now();
  this.endTime = this.startTime + duration;
  this.rotate = 0;
  this.angle = 0;
  this.angleCounter = 0;
  this.currentValue = 0;
  this.readyRemove = false;
  this.avatarSetup = true;

  sound.playbackRate = random(.8,1.5);
  sound.play();

  this.avatarGrow = function(){
    if (this.time >= this.endTime)
    {
      this.state = 'avatarIsWalking';
    }

    var elapsed =  this.time - this.startTime;
    var value = easeOutBounce(elapsed, .001, totChange, duration);

    if(value > .99){ value = 0.99; } // This is required from keep the tween from increasing too far
    this.currentValue =value; // this is needed to reverse the tween.

    this.avatarWidth = (this.image.width) * value/3;
    this.avatarHeight = (this.image.height) * value/3;//
  },
  this.avatarShrink = function(){
    if (this.time >= this.endTime)
    {
      this.state = 'avatarIsWalking';
      this.readyRemove = true;
    }

    var elapsed =  this.time - this.startTime;
    var value = easeInOutElastic(elapsed, this.currentValue, -this.currentValue, duration2);

    if(value < 0){ value = 0.000001; } // This is required from keep the tween from reversing too far

    this.avatarWidth = (this.image.width) * (value/3);
    this.avatarHeight = (this.image.height) * (value/3);//
  },
  this.calculateSpeed = function(){
      this.speed = abs(this.x - this.previousX) + abs(this.y - this.previousY);
      //speed = speed;
      //console.log(speed);
      this.previousX = this.x;
      this.previousY = this.y;
  },
  this.display = function(){
    console.log()

    this.time = performance.now();

    while (this.avatarSetup){
      this.x = constrain( map(this.random(),0,1, -.5,1.5) * width, 0 - this.avatarWidth, width + this.avatarWidth ) ;//constrain(this.x + this.random()*4, 0, width - (this.image.width/2));
      this.y = constrain( map(this.yRandom(), 0, 1, -.5, 1.5) * height, 0 - this.avatarHeight , height + this.avatarHeight );//constrain(this.y + this.random()*4, 0, height - (this.image.height/2));

      if(!collidePointRect(this.x,this.y,(500-100),0,(680+100),860)) {
            /*
            After it checks to see if the position is in the middle
            it then checks to see if the x and y are inside the screen
            I offset the detection by 100 for x and 200 for y
            We could not use the avatar width or height because
            of the animation they start at 0 or 1 pixel so the offset is so small
            // that they would still appear offscreen
            */
            if(this.x > 100 && this.x < windowWidth - 100 &&
              this.y > 200 && (this.y) < windowHeight - 200){
            console.log('x:'+this.x + ' y:'+this.y )

            this.avatarSetup =false;
            break;
          }
       }
    }

    this.x = constrain( map(this.random(),0,1, -.5,1.5) * width, 0 - this.avatarWidth, width + this.avatarWidth ) ;//constrain(this.x + this.random()*4, 0, width - (this.image.width/2));
    this.y = constrain( map(this.yRandom(), 0, 1, -.5, 1.5) * height, 0 - this.avatarHeight , height + this.avatarHeight );//constrain(this.y + this.random()*4, 0, height - (this.image.height/2));


    if(this.image.width != 1){ // this necessary until the image is loaded

      switch(this.state) {
        case 'avatarIsGrowing':
          this.avatarGrow();
          break;
        case 'avatarIsShrinking':
          this.avatarShrink();
          break;
        case 'avatarIsWalking':
          //this.avatarShrink();
          break;
      }

      this.calculateSpeed();

      var angle = sin(this.angleCounter * 2 * PI); //-1, 1
      angle =  round(angle * 1) / 1; // snap
      angle *= .75;

      var bounceOffset = sin((this.angleCounter + .25) * 2 * 2 * PI);
      //bounceOffset =  round(bounceOffset * 1) / 1; // snap
      bounceOffset *= 1.75;

      push();
      translate(this.x,this.y + bounceOffset);
      rotate(radians(angle));
      image(this.image,0-(this.avatarWidth/2),0-(this.avatarHeight),this.avatarWidth,this.avatarHeight);
      pop();


      var dT = (1/30.0); //delta time
      //console.log(speed);
      var animSpeed = map(this.speed, 0, 1, .6, .75);
      this.angleCounter = (this.angleCounter + dT * animSpeed);



    }
  }
}

function lerp(t, minn, maxx)
{
  return(t, 0, 1, minn, maxx);
}

function mousePressed() {
    //var a = new avatar('avatars/'+ Math.ceil(Math.random()*294)+'.png', random(0,width),random(0,height) )
    //avatars.push(a)
}

function keyPressed() {
  if (keyCode === LEFT_ARROW) {
     for (var i = 0; i < avatars.length; i++) {

       // if(avatars[i].id == 'aaa'){
          avatars[i].state = 'avatarIsShrinking';
          avatars[i].startTime = performance.now();
          avatars[i].endTime = avatars[i].startTime + duration2;
          soundReverse.playbackRate = random(.8,1.5);
          soundReverse.play();
      //}
        }
  }
}


